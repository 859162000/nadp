<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- HTTP 1.1 -->
    <meta http-equiv="pragma" content="no-cache">
    <!-- HTTP 1.0 -->
    <meta http-equiv="cache-control" content="no-cache">
    <title></title>
</head>
<script src="../js/jquery.CustomePagination.js" type="text/javascript"></script>
<script src="../js/pagination.js" type="text/javascript"></script>

<body>
<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>env list <small>[环境列表]</small></h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li><a href="#"><i class="fa fa-chevron-up"></i></a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                    </li>
                    <li><a href="#" id="closePage"><i class="fa fa-close"></i></a>
                    </li>
                </ul>
                <div class="clearfix"></div>
            </div>
            </br>
            <div class="x_content">
                名称：
                <input class="date-picker" type="text" id="name">
                <input class="btn btn-primary" type="button" value="查询" id="query">
                <input class="btn btn-primary" type="button" data-target=".bs-example-modal-lg" data-toggle="modal" value="新增">
            </div>
            </br>
            <div class="x_content">
                <table id="example" class="table table-striped responsive-utilities jambo_table">
                    <thead>
                    <tr class="headings">
                        <th> host </th>
                        <th>zk地址 </th>
                        <th>创建时间 </th>
                        <th>是否有效 </th>
                        <th>描述 </th>
                        <th>操作 </th>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <br />
    <br />
    <br />
    <div id="add" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">新增</h4>
                </div>
                <div class="modal-body">
                    <div class="form-horizontal form-label-left" >
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="add_name" > 名称 <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="add_name" type="text" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="add_zkAddress" > zk地址 <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="add_zkAddress" type="text" required="required" class="form-control col-md-7 col-xs-12" placeholder="xxx.xxx.xxx.xxx:xxxx">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="description" >描述 <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="description" type="text" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-5">
                                <button type="button" class="btn btn-primary" data-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" data-dismiss="modal" id="addCommit">提交</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="modify" class="modal fade modify-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <input type="hidden" id="modifyId" />
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title" >修改</h4>
                </div>
                <div class="modal-body">
                    <div class="form-horizontal form-label-left" >
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="modify_name" > 名称 <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="modify_name" type="text" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="modify_zkAddress" > zk地址 <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="modify_zkAddress" type="text" required="required" class="form-control col-md-7 col-xs-12" placeholder="xxx.xxx.xxx.xxx:xxxx">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="modifyDescription" >描述 <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="modifyDescription" type="text" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-5">
                                <button type="button" class="btn btn-primary" data-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" data-dismiss="modal" id="modifyCommit">提交</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="delete" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-hidden="true">
        <input type="hidden" id="deleteId">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel2">提示</h4>
                </div>
                <div class="modal-body">
                    <h4>确认作废?</h4>
                    <p>作废数据将被失效,为物理删除.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">否</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="confirmDelete">是</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="../js/datatables/js/jquery.dataTables.js"></script>
<script src="../js/datatables/tools/js/dataTables.tableTools.js"></script>
<script>

    $(function(){
        $(document).off("click","#confirmDelete");
        $(document).off("click","#addCommit");
        $(document).off("click","#query");
        $(document).off("click","#modifyBtn");
        $(document).off("click","#modifyCommit");
        $(document).off("click","#updateCommit");
        $(document).off("click","#deleteBtn");
        $(document).on("click","#query",function(){
            $('#example').dataTable().fnClearTable();
        });
        $(document).on("click","#deleteBtn",function(){
            $("#deleteId").val($(this).attr("delete-id"));
        })
        $(document).on("click","#modifyCommit",function(){
            var data =  {
                "id": $("#modifyId").val(),
                "name":$("#modify_name").val(),
                "zkAddress":$("#modify_zkAddress").val(),
                "description":$("#modifyDescription").val()
            };
            $.ajax(
                    {
                        type: "PUT",
                        url: "/api/env/update" ,
                        data:JSON.stringify(data),
                        dataType:"json",
                        success: function(data){
                            $('#example').dataTable().fnClearTable();
                        }
                    }
            )
        })
        $(document).on("click","#modifyBtn",function(){
            $("#modifyId").val($(this).attr("modify-id"));
            var data = JSON.parse($(this).attr("modify-data"));
            $("#modify_name").val(data.name);
            $("#modify_zkAddress").val(data.zkAddress);
            $("#modifyDescription").val(data.description);
        })
        $(document).on("click","#confirmDelete",function(){
            $.ajax(
                    {
                        type: "DELETE",
                        url: "/api/env/delete" ,
                        data:JSON.stringify({"id":$("#deleteId").val()}),
                        dataType:"json",
                        success: function(data){
                            $('#example').dataTable().fnClearTable();
                        }
                    }
            )
        });
        $(document).on("click","#addCommit",function(){
            var data =  {     "name":$("#add_name").val(),
                "zkAddress":$("#add_zkAddress").val(),
                "description":$("#description").val()
            };
            $.ajax(
                    {
                        type: "PUT",
                        url: "/api/env/insert" ,
                        data:JSON.stringify(data),
                        dataType:"json",
                        success: function(data){
                            $('#example').dataTable().fnClearTable();
                        }
                    }
            )
        })
    })
    var asInitVals = new Array();

    function retrieveData(sSource,aoData, fnCallback){
        var ajaxParamData = new Object();
        $.each(aoData,function(index,data){
            if(data.name == "sEcho"){
                ajaxParamData.sEcho = data.value+"";
            }else if(data.name == "iDisplayStart"){
                ajaxParamData.iDisplayStart = data.value+"";
            }else if(data.name == "iDisplayLength"){
                ajaxParamData.iDisplayLength = data.value+"";
            }
        });
        ajaxParamData.name = $('#name').val();
        $.post(sSource,JSON.stringify(ajaxParamData),function(result){
            fnCallback(result.info);
        }, "json");
    }

    function init() {
        var index = 0;
        var oTable = $('#example').dataTable({
            "sAjaxDataProp" : "aaData",
            "aoColumnDefs": [
                {
                    'bSortable': false,
                    'aTargets': [0,1,2,3,4,5]
                } //disables sorting for column one
            ],
            "aoColumns" : [{
                "data" : "name"
            },{
                "data" : "zkAddress"
            },{
                "data" : "createDate"
            },{
                "data" : "status",
                "mRender":function(data,type,full){
                    if(data+"" == "1"){
                        return "有效";
                    }else if(data+"" == "0"){
                        return "无效";
                    }else{
                        return "未知";
                    }
                }
            },{
                "data" : "description"
            },{
                "data" : "id",
                "mRender":function(data,type,full){
                    return '<div class="btn-group" >' +
                            "<a id='modifyBtn' class='btn btn-xs btn-info' data-target='.modify-modal' data-toggle='modal' modify-data='"+JSON.stringify(full)+"'  modify-id='"+data+"'>修改</a>" +
                            "<a id='deleteBtn' class='btn btn-xs btn-info' data-target='.bs-example-modal-sm' data-toggle='modal' delete-id='"+data+"'>删除</a>" +
                            '</div>'
                }
            } ],
            "bFilter": false,
            "bAutoWidth": true, //自适应宽度
            "bLengthChange":false,
            "sPaginationType": "full_numbers",
            "sAjaxSource":"/api/env/list",
            "fnServerData": retrieveData,// 获取数据的处理函数
            "bServerSide" : true,
            "bDestroy": true
        });
        $("tfoot input").keyup(function () {
            /* Filter on the column based on the index of this element's parent <th> */
            oTable.fnFilter(this.value, $("tfoot th").index($(this).parent()));
        });
        $("tfoot input").each(function (i) {
            asInitVals[i] = this.value;
        });
        $("tfoot input").blur(function (i) {
            if (this.value == "") {
                this.className = "search_init";
                this.value = asInitVals[$("tfoot input").index(this)];
            }
        });
    }
    init();
</script>
</html>